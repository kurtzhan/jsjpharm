(function(f,d,e,c){var h=f.document,g=function(k){d.dialog({title:"提示",width:0,content:k})},j=false,i=function(l,p,m,k){var o,n;p=typeof p=="function"?p:function(){};if(!k&&j){return}k?"":j=true;n=true;d.ajax({url:l,data:m||{},dataType:"json",type:"post",success:function(q){clearTimeout(o);j=false;n&&p(q)},error:function(){clearTimeout(o);j=false;n&&p({error:"error"})}});o=setTimeout(function(){n=false,j=false;p({error:"timeout"})},5000)};d.extend(e,{innerSource:(function(){var k=(h.referrer||"").toLowerCase();if(/\/\/[^\/]+?\/search\//.test(k)){return"SEARCH"}if(d.getHashPara("from")=="specialtopic"){return"SPETOPIC"}return"DETAIL"})(),isHasContent:false,showTopTipFor:function(l,p,m,o){var n=d("<div class='smallTips "+l+"'><span>"+m+"</span><span class='cusp'></span></div>").appendTo(h.body),r=d(p).offset(),q=n.outerHeight(),k=o==c?5000:o;n.css({left:r.left,top:r.top-q-12});if(k){f.setTimeout(function(){n.fadeOut(function(){d(this).remove()})},k)}},quickInit:function(){this.init_cut_str();this.lazyLoadImg();e.loadCdnJS(["js/product/pro_pinglun.js","js/product/preview.js"],function(){e.init_navTab();e.goods_consult.init();if(f.location.href.indexOf("#P_nav")>0){d("#userRating_T").click()}d("#js_toCommnet").click(function(){d("#userRating_T").trigger("click")});e.preview_init("a[name=js_preview]",".commWrap")});b.init();this.pro_property()},myInit:function(){e.updateCartInfo();e.addBHistory(d("#goodsId").val());e.getBHistoryList();this.init_recommond();e.bindCartMouseEvt();this.jumpToAnchor(f.location.search);this.navFix();d(".com_nav").bindTab(d.noop,"click","span");d(".goods_summary").delegate(".viewAll","click",function(){if(d(this).html()=="展开"){d(this).parent("li").children(".afterFix").hide();d(this).parent("li").children(".beforeFix").show();d(this).addClass("close");d(this).html("收起")}else{d(this).parent("li").children(".afterFix").show();d(this).parent("li").children(".beforeFix").hide();d(this).removeClass("close");d(this).html("展开")}});this.imgActiveX();d("em[name=js_buyBox]").each(function(k){new a(d(this),{blur:k?false:function(l){e.showTopTipFor("goods_max_tip",this,l?("商品数量不能大于"+(l||1000)+"！"):("商品库存不足"),3000)}})});d("em[name=js_partnerBuyBox]").each(function(k){new a(d(this),{blur:k?false:function(l){e.showTopTipFor("goods_max_tip",this,"商品数量不能大于"+(l||1000)+"！",3000)}})});d("#AOGnotice").bind("click",function(){e.stockNotice(d("#goodsId").val(),d("input[name=goods[0].skuId]").eq(0).val())});e.initAddrSelect()},init_navTab:function(){var k={navBox:d("#P_nav span"),activeB:d("#goodsDetail_T")};k.navBox.bind("click",function(){if(!d(this).hasClass("active")){var l=d(this).attr("id");d(this).addClass("active");k.activeB.removeClass("active");d("#"+k.activeB.attr("id").replace("_T","")).hide();d("#"+l.replace("_T","")).show();k.activeB=d(this);if(l=="userRating_T"){d("#goodsQA").hide()}else{if(l=="goodsQA_T"){d("#userRating").hide()}else{d("#userRating").show();d("#goodsQA").show()}}d(f).scrollTop(d(".goodsDetailWrap").offset().top+d("#js_zuhetuijie").height())}})},imgActiveX:function(){var k={upUl:d("#litimgUl"),upUlMaxH:d("#litimgUl").height()-385,allLi:d("#litimgUl li"),nowLi:d("#litimgUl li").eq(0),show:d("#showImg"),litimgUp:d("#litimgUp"),litimgDown:d("#litimgDown"),showImgBox:d("#showImgBox"),showDetails:d("#showDetails"),imgShadow:d("#showImgBox b"),showImg:d("#showImgBig"),ulTop:0,imgOffset:d("#showImgBox").offset(),mousePosition:function(l){if(l.pageX||l.pageY){return{x:l.pageX-k.imgOffset.left,y:l.pageY-k.imgOffset.top}}return{x:l.clientX-k.imgOffset.left+h.body.scrollLeft-h.body.clientLeft,y:l.clientY-k.imgOffset.top+h.body.scrollTop-h.body.clientTop}}};f.onresize=function(){k.imgOffset=d("#showImgBox").offset()};k.imgOffset=d("#showImgBox").offset();k.allLi.mouseenter(function(){k.nowLi.removeClass("active");d(this).addClass("active");k.nowLi=d(this);var l=d(this).find("img").attr("src").replace("_70_70","_430_430");var m=d(this).find("img").attr("src").replace("_70_70","");k.show.attr("src",l);k.showImg.attr("src",m);d("#showLocalImg").attr("href",m)});k.litimgUp.bind("click",function(){if(!d(this).hasClass("scrollDis")){k.ulTop+=77;if(k.ulTop==0){d(this).addClass("scrollDis")}k.upUl.animate({top:k.ulTop+"px"},500);k.litimgDown.removeClass("scrollDis")}});k.litimgDown.bind("click",function(){if(!d(this).hasClass("scrollDis")){k.ulTop-=77;if(k.ulTop==-k.upUlMaxH){d(this).addClass("scrollDis")}k.upUl.animate({top:k.ulTop+"px"},500);k.litimgUp.removeClass("scrollDis")}});k.showImgBox.mousemove(function(n){var m=n||f.event;var l=k.mousePosition(m);if(l.x>115&&l.x<315){k.imgShadow.css("left",l.x-115+"px");k.showImg.css("left",-(l.x-115)*1.86+"px")}else{if(l.x>=315){k.imgShadow.css("left","200px");k.showImg.css("left","-370px")}else{k.imgShadow.css("left","0px");k.showImg.css("left","0px")}}if(l.y>115&&l.y<315){k.imgShadow.css("top",l.y-115+"px");k.showImg.css("top",-(l.y-115)*1.86+"px")}else{if(l.y>=315){k.imgShadow.css("top","200px");k.showImg.css("top","-370px")}else{k.imgShadow.css("top","0px");k.showImg.css("top","0px")}}k.imgShadow.show();k.showDetails.show()});k.showImgBox.mouseleave(function(){k.imgShadow.hide();k.showDetails.hide()})},addGoodsToMyFav:function(k){this.addGoodsToFav(k,function(n,m){if(m==11||m==12){var o=d("#favNumBox"),l=o[0]?+(o.html().replace(/\D/g,"")||0):-1;if(l>=0){o.html("(人气"+(l+1)+")")}}})},navFix:function(){var o=d(f),p=d("#P_nav"),l=p.offset().top,n=d("a.aAddCart,a.aBuyBtn"),m=d("#js_zuhetuijie").length?d("#js_zuhetuijie").height():0,k=function(){var q=o.scrollTop();if(q>=l){p.addClass("P_navFix");n.css("display","inline-block");if(p.css("position")=="absolute"){p.css("top",q-l+m)}}else{p.removeClass("P_navFix");n.css("display","none");p.removeAttr("style")}};o.scroll(k);k()},addToCart:function(o,m,n,l){if(e._add2CartLock){return}if(!b.check()){l&&d(f).scrollTop(d("#js_skuBox").offset().top);return}e._add2CartLock=true;var k=+(d.trim(d(".buyNum").val()).replace(/\D/g,"")||"1")||1;e.addGoodsInfoToCookie(n,function(){e._add2CartLock=false},k,true,d("input[name=goods[0].skuId]").val())},buyNow:function(l){var k=d("#buyBtn").closest("form");k.find("[_name=innerSource]").val(this.innerSource);if(!b.check()){if(d(l.target).closest("#P_nav").length){d(f).scrollTop(d("#js_skuBox").offset().top)}return}this.isLogin(function(m){if(m){e.readyGoToConfirm();k[0].submit()}else{easyNav.login(function(n){if(!n){e.readyGoToConfirm();k[0].submit()}})}})},buyNow2:function(l){var k=d("#buyBtn").closest("form").attr("target","_blank");k.find("[_name=innerSource]").val(this.innerSource);e.readyGoToConfirm();k[0].submit()},jumpToAnchor:function(k){if(k&&k.split("=")[1]&&(k.split("=")[1]=="articlepage")){f.location.hash="#articlepage"}},toggle_zuhetips:function(k){var l=d("#js_zuhetuijie .all_tips");if(typeof l[k]=="function"){l[k]()}},zuheBuy2:function(m){var l=d("#buyZuHeBtn").closest("form"),k=d("#partnerNum").val();l.find("[_name=innerSource]").val("DETAILBP");l.find("[_name=tempBuyAmount]").val(k);this.isLogin(function(n){if(n){e.readyGoToConfirm();l[0].submit()}else{easyNav.login(function(o){if(!o){e.readyGoToConfirm();l[0].submit()}})}})},init_cut_str:function(){var k=d("#js_zuhetuijie p.cut_tips");if(k.height()>40){k.width(640).addClass("ellipsis");d("#js_zuhetuijie a.zk").show()}},add_activity:function(){var l,k=[];d.get("/goodsAjax/getGoodsPageShowActivity.html?goodsId="+d("#goodsId").val(),function(m){if(m.retCode==200&&m.infoList instanceof Array){m.infoList.length&&k.push('<div class="mb10">');while(l=m.infoList.shift()){k.push(d.format('<div class="tc"><a href="{imgHyperLink}" target="_blank"><img src="{imgUrl}"></a></div>',l))}k.length&&k.push("</div>");k.length&&d("#goodsDetail h3.productAd").after(k.join(""))}},"json")},showRecommondGoods:function(l,k){i("/goodsRecommendAjax.html",function(m){if(m.retcode==200&&(m.list||[]).length){e.randerRecommondHtml(m.list,l==""?"惊爆特价":"根据浏览为您推荐")}},{goods_ids:l,isAlwaysRecom:k})},randerRecommondHtml:function(m,o){var l,k=[],n=d("#recommondWrap");k.push("<h3><strong>"+o+"</strong></h3><div class='productsView clearfix'>");while(l=m.shift()){k.push(e.getRecommondHtml(l))}k.push("</div>");n.html(k.join(""))},getRecommondHtml:function(l){var k=d(".btmWrap #from").val(),o=['<div class="product">'],q,m,r,p,n;if(l.recommendReason){o.push('<a href="/product/'+l.goodsId+".html"+((k=="")?"":"#from="+k)+'" target="_blank" class="introDetail" style="opacity: 0;"><em></em><span>'+l.recommendReason+"</span></a>")}o.push('<a class="productImg" target="_blank" href="/product/'+l.goodsId+".html"+((k=="")?"":"#from="+k)+'"><img width="150" height="150" border="0" title="'+l.title+'" alt="'+l.title+'" src="'+l.imageUrlFor170+'">');if(l.actualStorageStatus==0){q="stockoutIcon"}if(q){o.push('<span class="'+q+'"></span>')}o.push("</a>");o.push('<p class="introduceTit">'+l.introduce+"</p>");o.push('<p class="productTit"><a href="/product/'+l.goodsId+".html"+((k=="")?"":"#from="+k)+'" title="'+l.title+'" target="_blank">'+l.title+'</a></p><p class="productPrice clearfix"><span class="price">¥'+e.getPriceStr(l.actualCurrentPrice)+"</span></p>");o.push('<p class="productActLink">');if(l.activityLinkList){o.push(l.activityLinkList.join(""))}o.push("</p>");o.push("</div>");return o.join("")},init_recommond:function(){var o=LS.get("NTES_BAOJIAN_RV"),k,l=[],n=0,m="";if(o){k=o.split("|").slice(0,10);d.each(k,function(p){l[p]=k[p].split("_")[0]});m=l.join(",")}e.showRecommondGoods(m,1)},pro_property:function(){var p=d("#goodsDetail"),l,n=d("ul.goods_parameter",p),m,o,k;if(p.length==0||n.length==0){return}k=d("li",n).eq(0);l=(k.height()+parseInt(k.css("padding-top")))*5-parseInt(n.css("padding-bottom"))/2;if(d("li",n).length>10){o=n.height();m=l;n.height(l);d("h4.goodsParaTit em.zk",p).show().click(function(){if(d(this).hasClass("sq")){d(this).html("展开").removeClass("sq");n.height(m)}else{d(this).html("收起").addClass("sq");n.height(o)}})}},getPostageTxt:function(k,m){var l=d("#feeTxt");i("/postage/get.html",function(n){if(n.retcode==200&&n.postage){if(n.postage=="不配送"){l.html("<strong>该地区暂不支持配送</strong>")}else{l.html(n.deliveryway+"：¥"+n.postage+"元")}}else{l.html("<strong>数据获取失败，请刷新页面重试</strong>")}},{goodsId:k,cityCode:m},true);d.bjCookies("SHIPPING_TO_CITY_CODE",m)},initAddrSelect:function(){var p=d(".postage span.to").attr("code"),n=d("#goodsId").val(),k,o,m=d(".postage span.to"),l;e.getPostageTxt(n,p);d("#provinceBox>li>a").removeClass("selected");d(".postage").delegate("span.to","click",function(){e.openAddrSelect()}).delegate("b","click",function(){e.closeAddrSelect()});d("#provinceBox>li>a").click(function(){d("div.addrBox a.selected").removeClass("selected");d("div.addrBox li.currProvince").removeClass("currProvince");d(this).addClass("selected");k=d(this).parent("li");k.addClass("currProvince");o=k.nextAll(".cityBox").eq(0);p=k.attr("code");e.getCityList(p,o)});d("li.cityBox,ul.zxCity").delegate("a","click",function(){d("div.addrBox a.selected").removeClass("selected");d("div.addrBox li.cityBoxCurr").removeClass("cityBoxCurr");d(this).addClass("selected");p=d(this).parent("li").attr("code");e.getPostageTxt(n,p);e.closeAddrSelect();l=d(this).attr("title");m.html(l);m.attr("code",p);p=d("li.currProvince","#provinceBox").attr("code");if(d(this).parents("ul.zxCity").length){m.attr("province","")}else{m.attr("province",p)}})},openAddrSelect:function(){var p=d(".postage span.to").attr("code"),l=d(".postage span.to").attr("province"),m=d("#goodsId").val(),k,o,q=d("div.addrBox"),n=d("#provinceBox");d("li a.selected",q).removeClass("selected");d("li.cityBoxCurr",q).removeClass("cityBoxCurr");d("li.currProvince",n).removeClass("currProvince");k=d("li[code="+l+"]",q);k.addClass("currProvince");o=k.nextAll(".cityBox").eq(0);o.addClass("cityBoxCurr");if(k.length>0&&o.length>0){e.getCityList(k.attr("code"),o)}d("li[code="+p+"] a",q).addClass("selected");q.show()},closeAddrSelect:function(){d("div.addrBox").hide()},getCityList:function(n,o){var m,k=d("#cityData"),l=d("#provinceBox");d("li.cityBox",l).removeClass("cityBoxCurr");o.addClass("cityBoxCurr");m=d("#"+n,k).html();o.html(m)}});function a(l,k){this.box=l.eq(0);this.reduceNum=d("a.reduceNum",this.box);this.addNum=d("a.addNum",this.box);this.buyNum=d("input.buyNum",this.box);this.disstyle="ctrNumDis";this.flg=!this.addNum.hasClass("ctrNumDis");this.config=d.extend({},k);this.getMax=function(){var m=1000;if(d(".goodStore",this.box).length){m=parseInt(d(".goodStore",this.box).html())||0;m=Math.min(m,1000)}return m};this.bind_event();this.buyNum.trigger("blur")}a.prototype.bind_event=function(){var l=this.reduceNum,q=this.addNum,k=this.buyNum,n=this,p=this.config,m=this.flg,o=1;if(m){q.click(function(){var r=n.getMax();if(!q.hasClass("ctrNumDis")){o=parseInt(k.val(),10)||1;o=o>r?r:o;k.val(o<r?o+1:r);(o+1)==r&&q.addClass("ctrNumDis");o>=1&&l.removeClass("ctrNumDis")}})}l.click(function(){var r=n.getMax();if(!l.hasClass("ctrNumDis")){o=parseInt(k.val(),10)||1;o=o<=1?1:o;k.val(o<=1?1:o-1);(o-1)==1&&l.addClass("ctrNumDis");o<=r&&m&&q.removeClass("ctrNumDis")}});k.focusout(function(){var s=parseInt(this.value),r=n.getMax();l.removeClass("ctrNumDis");q.removeClass("ctrNumDis");if(r==0){this.value=0;l.addClass("ctrNumDis")}else{if(s<=1){this.value=1;l.addClass("ctrNumDis")}}if(s>=r){this.value=r;q.addClass("ctrNumDis")}if(s>r){p.blur&&d.proxy(p.blur,this)(r)}})};var b=(function(){var l,k={init:function(){l=d("#js_skuBox");if(!e.sku_map){return}d(".skuBox",l).length&&k.bind_event();k.init_view()},bind_event:function(){d("li[vid]",l).click(function(){l.removeClass("errBox");k.select_sku(d(this))})},select_sku:function(p){var n=p.parent(),m=p.attr("vid"),o=p.attr("imgurl")||"";if(o&&p.parents("ul.imgUl").length){d("#showImg").attr("src",o.replace("_30_30","_430_430"));d("#litimgUl li.active").removeClass("active");d("#showImgBig").attr("src",o.replace("_30_30",""))}if(p.hasClass("selectedLi")){p.removeClass("selectedLi");k.init_view();d("input.buyNum",l).trigger("focusout");return}d("li.selectedLi",n).removeClass("selectedLi");p.addClass("selectedLi");if(d("div.skuBox",l).length!=d("li.selectedLi",l).length){return}k.update_view()},update_view:function(){var o=d("li.selectedLi",l),n=[],m,p;o.each(function(){n.push(d(this).attr("vid"))});m=k.get_key(n);p=e.sku_map[m];p&&d("#js_currentPrice b").text(e.getPriceStr(+p.actualCurrentPrice));p&&d("#js_marketPrice").text(e.getPriceStr(+p.marketPrice));p&&d("input[name=goods[0].skuId]").val(p.skuId||"0");p&&k.update_store(p.actualStorageStatus==0?0:p.actualStore||0);d("input.buyNum",l).trigger("focusout")},get_key:function(m){if(!(m instanceof Array)||m.length==0){return""}m.sort(function(o,n){return parseInt(o,10)>parseInt(n,10)});return"_"+m.join("_")},update_store:function(o){var m=d("#js_goodStore"),n=d("#js_storagetxt");n.text(o>5?"库存充足":(o==0?"库存不足":"库存"+o+"件"));m.text(o||0)},init_view:function(){var q=e.sku_map,p={},o=[],s=[],m=0,n,r;for(n in q){r=q[n];o.push(parseFloat(r.marketPrice||0));s.push(parseFloat(r.actualCurrentPrice||0));m+=parseInt(r.actualStore||0)}if(s.sort(function(u,t){return parseFloat(u,10)>parseFloat(t,10)}).length){if(s[0]==s[s.length-1]){d("#js_currentPrice b").text(e.getPriceStr(s[0]))}else{d("#js_currentPrice b").text(e.getPriceStr(s[0])+"-"+e.getPriceStr(+s.pop()))}}if(o.sort(function(u,t){return parseFloat(u,10)>parseFloat(t,10)}).length){if(o[0]==o[o.length-1]){d("#js_marketPrice").text(e.getPriceStr(o[0]))}else{d("#js_marketPrice").text(e.getPriceStr(o[0])+"-"+e.getPriceStr(o.pop()))}}k.update_store(m);d("#js_buyBox input.buyNum").trigger("focusout")},check:function(){if(d(".skuBox",l).length==0){return true}if(d("div.skuBox",l).length!=d("li.selectedLi",l).length){l.addClass("errBox");return false}else{if(parseInt(d("#js_goodStore").text(),10)<1){d("input.buyNum",l).trigger("focusout");l.addClass("errBox");return false}else{l.removeClass("errBox");return true}}}};return k})()})(window,jQuery,Core);